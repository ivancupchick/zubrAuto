<div class="card">
  <div class="card-body">
    <form
      *ngIf="form"
      [formGroup]="form"
      (ngSubmit)="filter()">
      <div class="flex flex-row justify-content-start align-items-center row-gap-1 col-12">
        <p-multiSelect
          class="ml-2"
          [options]="dealStatuses"
          formControlName="dealStatus"
          [filter]="true"
          filterBy="name"
          optionLabel="name"
          optionValue="value"
          [maxSelectedLabels]="2"
          selectedItemsLabel="{0} статусов выбрано"
          placeholder="Статус сделки"
          (onChange)="filter()"/>

        <p-dropdown
          class="ml-2"
          [options]="clientStatuses"
          formControlName="clientStatus"
          [filter]="true"
          filterBy="name"
          optionLabel="name"
          optionValue="value"
          placeholder="Статус клиента"
          [showClear]="true"
          (onChange)="filter()"/>

        <p-calendar
          class="ml-2"
          appendTo="body"
          formControlName="date"
          selectionMode="range"
          [showTime]="false"
          [firstDayOfWeek]="1"
          placeholder="Даты"
          [showClear]="true"
          (onClose)="filter()"></p-calendar>
        
        <p-dropdown
          class="ml-2"
          [options]="sourceList"
          formControlName="source"
          [filter]="true"
          filterBy="name"
          optionLabel="name"
          optionValue="value"
          placeholder="Источник"
          [showClear]="true"
          (onChange)="filter()"/>

        <p-dropdown
          class="ml-2"
          [options]="specialistList"
          formControlName="specialist"
          [filter]="true"
          filterBy="name"
          optionLabel="name"
          optionValue="value"
          placeholder="Специалист"
          [showClear]="true"
          (onChange)="filter()"/>
        
        <input 
          pInputText 
          class="ml-2 p-inputtext" 
          type="text" 
          formControlName="number" 
          pInputText 
          placeholder="Телефон"/>
      </div>
    
      <p-toolbar>
        <div class="p-toolbar-group-left">
          <span>Кол-во: {{ (clientBaseService.list$ | async)?.total || 0 }}</span>
          <button
            pButton
            type="button"
            label="Добавить клиента"
            icon="pi pi-plus"
            (click)="openNewClientWindow()"
          ></button>
        </div>
      
        <div class="p-toolbar-group-right">
          <p-button size="small" label="Filter" type="submit" (onClick)="filter()" class="mr-2">
            <i class="pi pi-refresh"></i>
          </p-button>
          <p-button size="small" type="button" label="Clear" (onClick)="clearFilters()" class="mr-2">
          </p-button>
        </div>
      </p-toolbar>
    </form>
  </div>
</div>

<div class="grid-wrapper">
  <za-pageagle-grid
    [gridConfig]="gridConfig"
    [actions]="gridActionsConfig"
    [getColorConfig]="getColorConfig"
    [dataService]="clientBaseService"
    [sortField]="'date'"
    [first] = "first"
  ></za-pageagle-grid>
</div>

<za-spinner *ngIf="loading$ | async"></za-spinner>
